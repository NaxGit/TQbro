<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./Carbonated/Mainstyles.css">
    <link rel="stylesheet" href="./Carbonated/Steptronic.css">
    <link rel="stylesheet" href="./Carbonated/VirtualOSK.css">
    <script src="./Oxygenated/keys.js"></script>
    <script src="./Oxygenated/Steptronic.js"></script>
    <script src="./caffeine/dexie.js"></script>
    <title>⊤⌕</title>
</head>

<body>
    <delta-head></delta-head>
    <comet-flow></comet-flow>
    <slide-menu></slide-menu>
    <block-find></block-find>
    <div id="Icons"></div>
    <div id="Cards"></div>
    <board-vosk></board-vosk>
    <delta-foot></delta-foot>

<script type="module">

// const Index = await new Dexie("Queens").open().then().catch(Error, e => {window.location.href = "./Machining/upgrade.html";});

const idata = await new Dexie("Uchi").open();
const Stock = await idata.table("stock").toArray();

const Icons = document.getElementById("Icons");
const Cards = document.getElementById("Cards");

function icons()
{
Stock.forEach((Item) =>
{
    let icon = document.createElement("img");
        icon.src = Item.Imge;
        icon.onclick = function () { fnCards(Item.SKU); };
        Icons.append(icon);
});
} icons();

function fnCards(i)
{
    document.getElementById("Cards").innerHTML = "";
const selected = Stock.find(({ SKU }) => SKU === i);
    
    let clone = document.createElement('div');
    clone.className = "GUMCards";


    clone.innerHTML =
    `
  <img src="${selected.Imge}" class="card-img-top" alt="...">
  <div class="card-body">
    <h5 class="card-title">${selected.Name}</h5>
    <p class="card-text">Selling price Ksh. ${selected.Sell}</p>
    <p class="card-text">Stock in shop ${selected.Qtys} pcs</p>
    <a href="#" id="Capil" class="btn btn-primary">Tap to sell</a>
  </div>
  `;
    document.getElementById("Cards").append(clone);

    let rapid = document.getElementById("Capil");

    rapid.onclick = function(){ Saless(selected); };



}

async function Saless(yok) {
    console.log(yok);

    let nos = yok.Qtys;

    let nes = nos - 1;

    yok.Qtys = nes;

    const Stamp = new Date().getTime();

    yok.Stamp = Stamp;

    let ilink = await new Dexie("Uchi").open();
    let table = await ilink.table("sales");
    let addin = await table.put(yok);
}

</script>
</body>

</html>